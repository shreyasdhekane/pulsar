<div class="detail-page">
  <nav class="navbar">
    <div class="logo">
      <span class="logo-text">Pulsar</span>
    </div>
    <div class="back-btn" (click)="goBack()">← Back to Dashboard</div>
  </nav>

  @if (loading) {
    <div class="loading">Loading endpoint data...</div>
  }

  @if (!loading && endpoint) {
    <div class="detail-header">
      <div class="header-top">
        <span class="dot" [style.background]="getStatusColor()"></span>
        <h1>{{ endpoint.name }}</h1>
        <span
          class="status-badge"
          [style.color]="getStatusColor()"
          [style.border-color]="getStatusColor()"
        >
          {{ endpoint.latestPing?.isUp ? 'Operational' : 'Down' }}
        </span>
      </div>
      <p class="url">{{ endpoint.url }}</p>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="label">Uptime (All Time)</div>
        <div class="value purple">{{ endpoint.uptimePercent }}%</div>
      </div>
      <div class="stat-card">
        <div class="label">Avg Response</div>
        <div class="value green">{{ endpoint.avgResponseTime }}ms</div>
      </div>
      <div class="stat-card">
        <div class="label">Fastest</div>
        <div class="value yellow">{{ endpoint.minResponseTime }}ms</div>
      </div>
      <div class="stat-card">
        <div class="label">Slowest</div>
        <div class="value red">{{ endpoint.maxResponseTime }}ms</div>
      </div>
    </div>

    <div class="uptime-section">
      <div class="section-label">24-Hour Uptime Timeline</div>
      <div class="uptime-bars">
        @for (bar of uptimeBars; track $index) {
          <div class="bar" [class]="bar.status" [title]="bar.label"></div>
        }
      </div>
      <div class="uptime-labels">
        <span>24h ago</span>
        <span>12h ago</span>
        <span>Now</span>
      </div>
    </div>

    <div class="chart-section">
      <div class="section-label">Response Time — Last 24 Hours</div>
      <canvas id="detailChart"></canvas>
    </div>
  }
  @if (insights) {
    <!-- PERCENTILES -->
    <div class="stats-grid" style="margin-top: 24px">
      <div class="stat-card">
        <div class="label">p50 Response</div>
        <div class="value purple">{{ insights.p50 }}ms</div>
      </div>
      <div class="stat-card">
        <div class="label">p95 Response</div>
        <div class="value yellow">{{ insights.p95 }}ms</div>
      </div>
      <div class="stat-card">
        <div class="label">p99 Response</div>
        <div class="value red">{{ insights.p99 }}ms</div>
      </div>
      <div class="stat-card">
        <div class="label">Anomaly</div>
        <div class="value" [class]="insights.anomaly ? 'red' : 'green'">
          {{ insights.anomaly ? insights.anomalyPercent + '% slower' : 'Normal' }}
        </div>
      </div>
    </div>

    <!-- AI INSIGHTS -->
    <div class="insights-card">
      <div class="insights-header">
        <span class="ai-badge">⚡ AI Insights</span>
        @if (insights.anomaly) {
          <span class="anomaly-badge">Anomaly Detected</span>
        }
      </div>
      <p class="insights-text">{{ insights.summary }}</p>
    </div>

    <!-- INCIDENT TIMELINE -->
    @if (insights.incidents.length > 0) {
      <div class="incidents-section">
        <div class="section-label">Incident History (24h)</div>
        @for (incident of insights.incidents; track $index) {
          <div class="incident-item">
            <span class="incident-dot"></span>
            <div class="incident-info">
              <span class="incident-time">
                {{ incident.from | date: 'HH:mm' }}
                @if (incident.to) {
                  → {{ incident.to | date: 'HH:mm' }}
                } @else {
                  → Ongoing
                }
              </span>
              <span class="incident-duration">{{ incident.durationMinutes }} min downtime</span>
            </div>
          </div>
        }
      </div>
    }
  }
</div>
